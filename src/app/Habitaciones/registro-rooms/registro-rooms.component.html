<h2 mat-dialog-title class="dialog-title">Registro de Habitación</h2>

<form [formGroup]="roomForm" (ngSubmit)="onSubmit()" mat-dialog-content class="form-container">
  <div class="form-content">
    <div class="fields-section">

      <!-- ID -->
      <mat-form-field appearance="fill" class="custom-form-field">
        <mat-label>ID de habitación</mat-label>
        <input matInput type="number" formControlName="id_Rooms" placeholder="Ej: 101" />
        <mat-error *ngIf="roomForm.get('id_Rooms')?.hasError('required')">
          El ID es obligatorio
        </mat-error>
      </mat-form-field>

      <!-- Tipo de habitación -->
      <mat-form-field appearance="fill">
        <mat-label>Tipo de Habitación</mat-label>
        <mat-select formControlName="habitacion">
          @for (tipo of typesRooms; track tipo) {
          <mat-option [value]="tipo">
            {{ tipo | titlecase }}
          </mat-option>
          }
        </mat-select>
      </mat-form-field>

      <!-- Nivel -->
      <mat-form-field appearance="fill">
        <mat-label>Nivel</mat-label>
        <mat-select formControlName="nivel">
          <mat-option *ngFor="let nivel of typesRoomsLevel" [value]="nivel">
            {{ nivel }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <!-- Estado -->
      <mat-form-field appearance="fill">
        <mat-label>Estado</mat-label>
        <mat-select formControlName="estado">
          <mat-option *ngFor="let estado of typesRoomsStatus" [value]="estado">
            {{ estado | titlecase }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <!-- Precio -->
      <mat-form-field appearance="fill">
        <mat-label>Precio (Q)</mat-label>
        <input matInput formControlName="precio" type="number" min="0" />
      </mat-form-field>

      <!-- URL de imagen -->
      <mat-form-field appearance="fill">
        <mat-label>URL de imagen (Cloudinary)</mat-label>
        <input
          matInput
          formControlName="image_url"
          placeholder="https://res.cloudinary.com/..."
          (input)="onPreviewChange()"
        />
        <mat-hint>Sube la imagen a Cloudinary y pega aquí la URL</mat-hint>
        <mat-error *ngIf="roomForm.get('image_url')?.hasError('pattern')">
          URL inválida. Debe comenzar con http:// o https://
        </mat-error>
      </mat-form-field>

      <!-- Vista previa -->
      <div *ngIf="previewUrl" class="preview-container">
        <p class="preview-title">Vista previa:</p>
        <img [src]="previewUrl" alt="Vista previa de la habitación" class="preview-img" />
      </div>

      <!-- Mensaje de error general -->
      <h3 *ngIf="roomForm.invalid && roomForm.touched" class="error-msg">
        Todos los campos son obligatorios
      </h3>
    </div>
  </div>

  <!-- Botones -->
  <div class="form-actions" mat-dialog-actions>
    <button mat-raised-button color="primary" type="submit">Guardar</button>
    <button mat-button mat-dialog-close>Cancelar</button>
  </div>
</form>
