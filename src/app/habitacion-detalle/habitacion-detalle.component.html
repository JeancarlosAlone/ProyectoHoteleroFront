
<div class="detalle-container" *ngIf="!isLoading; else cargando">

  <!-- ENCABEZADO: Bot√≥n Regresar fuera de la imagen -->
  <div class="header-detalle">
    <button class="btn-regresar" (click)="regresar()">
      <i class="fa-solid fa-arrow-left"></i> Regresar
    </button>
  </div>

  <!-- BLOQUE 1: Imagen superior -->
  <div class="image-wrapper">
    <img
      [src]="habitacion?.image_url || 'https://via.placeholder.com/800x400?text=Habitaci√≥n+sin+imagen'"
      alt="Habitaci√≥n {{ habitacion?.habitacion }}"
      class="room-image"
    />
  </div>

  <!-- BLOQUES INFERIORES -->
  <div class="bloques-inferiores">

    <!-- BLOQUE 2: Datos del cliente -->
    <div class="bloque cliente">
      <h3>Datos del cliente</h3>

      <div>
        <label>Nombre: <span class="obligatorio">*</span></label>
        <input type="text" [(ngModel)]="cliente.nombre" name="nombre" />
        <div *ngIf="errores.nombre" class="mensaje-error">{{ errores.nombre }}</div>
      </div>

      <div>
        <label>Apellido: <span class="obligatorio">*</span></label>
        <input type="text" [(ngModel)]="cliente.apellido" name="apellido" />
        <div *ngIf="errores.apellido" class="mensaje-error">{{ errores.apellido }}</div>
      </div>

      <div>
        <label>DPI: <span class="obligatorio">*</span></label>
        <input type="text" [(ngModel)]="cliente.dpi" name="dpi" />
        <div *ngIf="errores.dpi" class="mensaje-error">{{ errores.dpi }}</div>
      </div>

      <div>
        <label>Tel√©fono: <span class="obligatorio">*</span></label>
        <input type="tel" [(ngModel)]="cliente.telefono" name="telefono" />
        <div *ngIf="errores.telefono" class="mensaje-error">{{ errores.telefono }}</div>
      </div>

      <div>
        <label>Correo electr√≥nico: <span class="obligatorio">*</span></label>
        <input type="email" [(ngModel)]="cliente.email" name="email" />
        <div *ngIf="errores.email" class="mensaje-error">{{ errores.email }}</div>
      </div>

      <div>
        <label>N√∫mero de personas: <span class="obligatorio">*</span></label>
        <input type="number" min="1" [(ngModel)]="cliente.numPersonas" name="numPersonas" />
        <div *ngIf="errores.numPersonas" class="mensaje-error">{{ errores.numPersonas }}</div>
      </div>

      <div class="fecha-group">
        <div>
          <label>Fecha de entrada: <span class="obligatorio">*</span></label>
          <input
            type="date"
            [(ngModel)]="cliente.fechaInicio"
            name="fechaInicio"
            [min]="minFechaEntrada"
            (change)="actualizarFechaSalida()"
          />
          <div *ngIf="errores.fechaInicio" class="mensaje-error">{{ errores.fechaInicio }}</div>
        </div>

        <div>
          <label>Fecha de salida: <span class="obligatorio">*</span></label>
          <input type="date" [(ngModel)]="cliente.fechaFin" name="fechaFin" [min]="minFechaSalida" />
          <div *ngIf="errores.fechaFin" class="mensaje-error">{{ errores.fechaFin }}</div>
        </div>
      </div>

      <div class="acciones-form">
        <button class="btn-limpiar" (click)="limpiarCampos()">Limpiar</button>
      </div>
    </div>

    <!-- BLOQUE 3: Detalle de habitaci√≥n -->
    <div class="bloque detalle-habitacion">
      <h3>Datos de la habitaci√≥n</h3>

      <p><strong>N√∫mero de habitaci√≥n:</strong> {{ habitacion?.id_Rooms }}</p>
      <p><strong>Tipo:</strong> {{ habitacion?.habitacion | titlecase }}</p>
      <p><strong>Nivel:</strong> {{ habitacion?.nivel }}</p>

      <p>
        <strong>Estado:</strong>
        <span [ngClass]="{
          'estado-libre': habitacion?.estado === 'libre',
          'estado-ocupada': habitacion?.estado === 'ocupada'
        }">
          {{ habitacion?.estado }}
        </span>
      </p>

      <p><strong>Precio por Noche:</strong> Q {{ habitacion?.precio }}</p>
      <p><strong>Precio Total por noche (USD):</strong> $ {{ precioPaypal(habitacion?.precio) }}</p>
     
      <hr />

      <!-- Bot√≥n para abrir modal de servicios -->
      <button class="btn-servicios" (click)="abrirMenuServicios()">
        <i class="fa-solid fa-concierge-bell"></i> Ver servicios adicionales
      </button>

      <!-- Lista de servicios seleccionados -->
<div class="servicios-seleccionados" *ngIf="serviciosSeleccionados.length > 0">
  <h4>Servicios seleccionados</h4>
  <ul class="lista-servicios">
    <li *ngFor="let s of serviciosSeleccionados">
      <div class="servicio-item">
        <span class="nombre">{{ s.nombre }}</span>

        <div class="precios">
          <ng-container *ngIf="s.descuento > 0; else sinDescuento">
            <span class="tachado">Q {{ s.precio }}</span>
            <span class="precio-final">Q {{ s.precioFinal }}</span>
            <span class="etiqueta-descuento">{{ s.descuento }}% OFF</span>
          </ng-container>

          <ng-template #sinDescuento>
            <span class="precio-normal">Q {{ s.precio }}</span>
          </ng-template>
        </div>
      </div>
    </li>
  </ul>

  <div class="totales-servicios">
    <p><strong>Total servicios:</strong> Q {{ calcularTotalServicios() }}</p>
    <p><strong>Total a pagar (USD):</strong> $ {{ calcularTotalUSD() }}</p>
  </div>
</div>


      <button class="btn-pago" (click)="irAPago()">Pagar Reserva</button>
    </div>
  </div>
</div>

<!-- MODAL DE SERVICIOS (SIN IM√ÅGENES, MISMO DISE√ëO) -->
<div class="modal-overlay" *ngIf="mostrarMenuServicios">
  <div class="modal-servicios">
    <div class="modal-header">
      <h3>üõéÔ∏è Servicios Adicionales</h3>
      <button class="close-btn" (click)="cerrarMenuServicios()">√ó</button>
    </div>

    <p *ngIf="nochesSeleccionadas" class="info-noches">
      üè® Estancia de <strong>{{ nochesSeleccionadas }}</strong>
      noche<span *ngIf="nochesSeleccionadas > 1">s</span> ‚Äî descuentos aplicados autom√°ticamente
      seg√∫n tu estad√≠a.
    </p>

    <div class="servicios-grid">
      <div class="servicio-card" *ngFor="let servicio of listaServicios">
        <div class="servicio-info">
          <h4>{{ servicio.nombre }}</h4>
          <p>{{ servicio.descripcion }}</p>

          <div *ngIf="servicio.descuento > 0" class="precio-con-descuento">
            <span class="precio-original">Q {{ servicio.precio }}</span>
            <span class="precio-final">Q {{ servicio.precioFinal }}</span>
            <span class="badge-descuento">-{{ servicio.descuento }}%</span>
          </div>

          <div *ngIf="!servicio.descuento || servicio.descuento === 0" class="precio-normal">
            <strong>Precio:</strong> Q {{ servicio.precio }}
          </div>

          <label class="check-servicio">
            <input type="checkbox" [(ngModel)]="servicio.seleccionado" />
            <span>Agregar</span>
          </label>
        </div>
      </div>
    </div>

    <div class="modal-acciones">
      <button class="btn-guardar" (click)="guardarServicios()">Guardar selecci√≥n</button>
      <button class="btn-cerrar" (click)="cerrarMenuServicios()">Cerrar</button>
    </div>
  </div>
</div>


<!-- CARGANDO -->
<ng-template #cargando>
  <div class="loading">Cargando informaci√≥n de la habitaci√≥n...</div>
</ng-template>


