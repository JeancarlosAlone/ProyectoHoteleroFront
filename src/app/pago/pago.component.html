<div class="pago-container">
  <h2>Pago de Reserva</h2>

  <!-- Búsqueda del cliente -->
  <div class="busqueda">
    <input
      type="text"
      placeholder="Buscar por nombre, apellido o ID de habitación"
      [(ngModel)]="clienteIdentifier"
      (input)="buscarCliente()"
    />
    <button class="btn-limpiar" (click)="limpiarBusqueda()">
      <i class="fa-solid fa-broom"></i> Limpiar
    </button>
  </div>

  <!-- Resultados de la búsqueda -->
  <div class="resultados" *ngIf="clientesEncontrados.length > 0">
    <p>Seleccione el cliente correcto:</p>
    <ul>
      <li *ngFor="let c of clientesEncontrados" (click)="seleccionarCliente(c)">
        {{ c.nameHuesped }} {{ c.apellidoHuesped }}
        <small>— Habitación #{{ c.habitacionAsignada?.id_Rooms }}</small>
      </li>
    </ul>
  </div>

  <hr />

  <!-- Resumen del pago -->
  <div *ngIf="cliente; else noCliente">
    <div class="resumen">
      <h3>Resumen de la reserva</h3>
      <p><strong>Nombre:</strong> {{ cliente?.nameHuesped }} {{ cliente?.apellidoHuesped }}</p>
      <p><strong>Monto a pagar (USD):</strong> $ {{ precioPaypal(habitacion?.precio) }}</p>

      <hr />

      <div class="correo-container">
        <label for="correo">Correo electrónico (obligatorio para enviar factura):</label>
        <input
          id="correo"
          type="email"
          [(ngModel)]="emailCliente"
          placeholder="ejemplo@correo.com"
          required
          (input)="verificarCorreo()"
          [class.invalid]="!correoValido && emailCliente"
        />
        <p *ngIf="!correoValido && emailCliente" class="error-text">
          Ingrese un correo válido antes de continuar.
        </p>
      </div>

      <div id="paypal-button-container"></div>
    </div>
  </div>

  <ng-template #noCliente>
    <p class="texto-secundario">Busque el cliente que tiene pendiente su pago de reserva</p>
  </ng-template>

  <p class="mensaje-pago">{{ mensaje }}</p>
</div>

<!-- Modal de confirmación -->
<div *ngIf="mostrarModal" class="modal-backdrop">
  <div class="modal-contenido">
    <h2>{{ mensajeModal }}</h2>
    <p>Será redirigido automáticamente...</p>
  </div>
</div>
