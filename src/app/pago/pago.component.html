<div class="pago-container">
  <h2>üí≥ Pago de Reserva</h2>

  <!-- ===================== B√öSQUEDA ===================== -->
  <div class="busqueda">
    <input
      type="text"
      placeholder="Buscar cliente por nombre"
      [(ngModel)]="clienteIdentifier"
    />
    <input
      type="date"
      [(ngModel)]="fechaFiltro"
      title="Filtrar por fecha de ingreso o salida"
    />
    <button (click)="buscarCliente()">Buscar</button>
  </div>

  <hr />

  <!-- ===================== RESUMEN ===================== -->
  <div *ngIf="cliente; else noCliente">
    <div class="resumen">
      <h3>Resumen de la habitaci√≥n</h3>
      <p><strong>ID:</strong> {{ habitacion?.id_Rooms }}</p>
      <p><strong>Tipo:</strong> {{ habitacion?.habitacion | titlecase }}</p>
      <p><strong>Nivel:</strong> {{ habitacion?.nivel }}</p>
      <p><strong>Precio por noche:</strong> Q {{ precioPorNoche | number: '1.2-2' }}</p>

      <h3>Servicios adicionales</h3>
      <div *ngIf="serviciosSeleccionados.length > 0; else sinServicios">
        <ul>
          <li *ngFor="let servicio of serviciosSeleccionados">
            {{ servicio.nombre }} ‚Äî
            <span *ngIf="servicio.precioFinal !== undefined">
              Q {{ servicio.precioFinal }}
              <small *ngIf="servicio.descuento && servicio.descuento > 0">
                ({{ servicio.descuento }}% desc.)
              </small>
            </span>
            <span *ngIf="servicio.precioFinal === undefined">
              Q {{ servicio.precio }}
            </span>
          </li>
        </ul>
        <p><strong>Total servicios:</strong> Q {{ cliente?.totalServicios || 0 | number: '1.2-2' }}</p>
      </div>
      <ng-template #sinServicios>
        <p class="texto-secundario">Sin servicios adicionales seleccionados.</p>
      </ng-template>

      <hr />

      <h3>Datos del cliente</h3>
      <p><strong>Nombre:</strong> {{ cliente?.nameHuesped }} {{ cliente?.apellidoHuesped }}</p>
      <p><strong>Tel√©fono:</strong> {{ cliente?.telefono }}</p>
      <p><strong>N√∫mero de personas:</strong> {{ cliente?.numPersonas }}</p>
      <p><strong>Estado:</strong> {{ cliente?.statusHuesped }}</p>

      <hr />

      <!-- ===================== CAMPO DE CORREO OBLIGATORIO ===================== -->
      <div class="correo-container">
        <label for="correo">Correo electr√≥nico (obligatorio para enviar factura):</label>
        <input
          id="correo"
          type="email"
          [(ngModel)]="emailCliente"
          placeholder="ejemplo@correo.com"
          required
          (input)="verificarCorreo()"
          [class.invalid]="!correoValido && emailCliente"
        />
        <p *ngIf="!correoValido && emailCliente" class="error-text">
          Ingrese un correo v√°lido antes de continuar.
        </p>
      </div>

      <hr />

      <h3>Total a pagar: <span class="total">Q {{ total | number: '1.2-2' }}</span></h3>
    </div>

    <!-- ===================== BOTONES PAYPAL ===================== -->
    <div *ngIf="correoValido; else noCorreo">
      <div id="paypal-button-container"></div>
    </div>

    <ng-template #noCorreo>
      <p class="mensaje-pago aviso">
        Ingrese un correo v√°lido para habilitar el pago.
      </p>
    </ng-template>
  </div>

  <!-- ===================== SIN CLIENTE ===================== -->
  <ng-template #noCliente>
    <p class="texto-secundario">
      Busque un cliente pendiente de pago para mostrar los detalles aqu√≠.
    </p>
  </ng-template>

  <!-- ===================== MENSAJE GENERAL ===================== -->
  <p class="mensaje-pago">{{ mensaje }}</p>
</div>

<!-- ===================== MODAL ===================== -->
<div *ngIf="mostrarModal" class="modal-backdrop">
  <div class="modal-contenido">
    <h2>{{ mensajeModal }}</h2>
    <p>Ser√° redirigido autom√°ticamente...</p>
  </div>
</div>
